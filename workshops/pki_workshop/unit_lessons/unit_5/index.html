<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title> | Red Hat | Public Sector</title>

    
    
    <link rel="stylesheet" href="/node_modules/patternfly/dist/css/patternfly.min.css" />
    <link rel="stylesheet" href="/node_modules/patternfly/dist/css/patternfly-additions.min.css" />

    
    <link rel="stylesheet" href="/node_modules/highlight.js/styles/darkula.css" />

    
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/asciidoc.css" />
    <link rel="stylesheet" href="/css/custom.css" />
    <link rel="stylesheet" href="/css/toastr.min.css" />

    
    <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>

    
    <script src="/node_modules/patternfly/node_modules/jquery/dist/jquery.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/c3/c3.min.js"></script>
    <script src="/node_modules/patternfly/node_modules/d3/d3.min.js"></script>

    
    
    <script src="/node_modules/patternfly/node_modules/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="/node_modules/patternfly/node_modules/drmonty-datatables-colvis/js/dataTables.colVis.js"></script>
    <script src="/node_modules/patternfly/node_modules/datatables.net-colreorder/js/dataTables.colReorder.js"></script>

    
    
    <script src="/node_modules/patternfly/dist/js/patternfly.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/patternfly-bootstrap-combobox/js/bootstrap-combobox.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/moment/min/moment.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-select/dist/js/bootstrap-select.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/patternfly-bootstrap-treeview/dist/bootstrap-treeview.min.js"></script>

    
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/jquery-match-height/dist/jquery.matchHeight-min.js"></script>
    
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/clip.js"></script>

    
    <script src="/js/toastr.min.js"></script>

    
    <script src="/node_modules/highlight.js/lib/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body class="">
    

<nav class="navbar navbar-default navbar-inverse navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
      <svg width=150 height=auto id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 613 145"><defs><style>.cls-1{fill:#e00;}.cls-2{fill:#fff;}</style></defs><path class="cls-1" d="M127.47,83.49c12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89,8.69,103.76.5,97.51.5,91.69.5,90,8,83.06,8c-6.68,0-11.64-5.6-17.89-5.6-6,0-9.91,4.09-12.93,12.5,0,0-8.41,23.72-9.49,27.16A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33C22.27,52,.5,55,.5,74.22c0,31.48,74.59,70.28,133.65,70.28,45.28,0,56.7-20.48,56.7-36.65,0-12.72-11-27.16-30.83-35.78"/><path d="M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33l3.66-9.06A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45,12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42Z"/><path class="cls-2" d="M579.74,92.8c0,11.89,7.15,17.67,20.19,17.67a52.11,52.11,0,0,0,11.89-1.68V95a24.84,24.84,0,0,1-7.68,1.16c-5.37,0-7.36-1.68-7.36-6.73V68.3h15.56V54.1H596.78v-18l-17,3.68V54.1H568.49V68.3h11.25Zm-53,.32c0-3.68,3.69-5.47,9.26-5.47a43.12,43.12,0,0,1,10.1,1.26v7.15a21.51,21.51,0,0,1-10.63,2.63c-5.46,0-8.73-2.1-8.73-5.57m5.2,17.56c6,0,10.84-1.26,15.36-4.31v3.37h16.82V74.08c0-13.56-9.14-21-24.39-21-8.52,0-16.94,2-26,6.1l6.1,12.52c6.52-2.74,12-4.42,16.83-4.42,7,0,10.62,2.73,10.62,8.31v2.73a49.53,49.53,0,0,0-12.62-1.58c-14.31,0-22.93,6-22.93,16.73,0,9.78,7.78,17.24,20.19,17.24m-92.44-.94h18.09V80.92h30.29v28.82H506V36.12H487.93V64.41H457.64V36.12H439.55ZM370.62,81.87c0-8,6.31-14.1,14.62-14.1A17.22,17.22,0,0,1,397,72.09V91.54A16.36,16.36,0,0,1,385.24,96c-8.2,0-14.62-6.1-14.62-14.09m26.61,27.87h16.83V32.44l-17,3.68V57.05a28.3,28.3,0,0,0-14.2-3.68c-16.19,0-28.92,12.51-28.92,28.5a28.25,28.25,0,0,0,28.4,28.6,25.12,25.12,0,0,0,14.93-4.83ZM320,67c5.36,0,9.88,3.47,11.67,8.83H308.47C310.15,70.3,314.36,67,320,67M291.33,82c0,16.2,13.25,28.82,30.28,28.82,9.36,0,16.2-2.53,23.25-8.42l-11.26-10c-2.63,2.74-6.52,4.21-11.14,4.21a14.39,14.39,0,0,1-13.68-8.83h39.65V83.55c0-17.67-11.88-30.39-28.08-30.39a28.57,28.57,0,0,0-29,28.81M262,51.58c6,0,9.36,3.78,9.36,8.31S268,68.2,262,68.2H244.11V51.58Zm-36,58.16h18.09V82.92h13.77l13.89,26.82H292l-16.2-29.45a22.27,22.27,0,0,0,13.88-20.72c0-13.25-10.41-23.45-26-23.45H226Z"/></svg>
      </a>
    </div>
    <div class="collapse navbar-collapse navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        
        
          
            <li>
              <a href="/">Home</a>
            </li>
          
        
          
            <li>
              <a href="/about/">About</a>
            </li>
          
        
          
            <li>
              <a href="/contact/">Contact</a>
            </li>
          
        
          
            <li>
              <a href="https://www.redhat.com/en/events">Events</a>
            </li>
          
        
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Workshops <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                
                  <li>
                    <a href="/workshops/agile_integrations_ci/">Agile Integrations Workshop - Citizen Integrator</a>
                  </li>
                
                  <li>
                    <a href="/workshops/agile_integrations_dev/">Agile Integrations Workshop - Developer</a>
                  </li>
                
                  <li>
                    <a href="/workshops/ansible_automation/">Ansible Automation Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/ansible_tower_intro/">Ansible Tower - an Introduction</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_container_intro/">Container Security - A Practical Introduction</a>
                  </li>
                
                  <li>
                    <a href="/workshops/containers_101/">Containers 101 Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/secure_software_factory/">DevSecOps Workshop - Secure Software Factory</a>
                  </li>
                
                  <li>
                    <a href="/workshops/containers_the_hard_way/">Linux Containers the Hard Way</a>
                  </li>
                
                  <li>
                    <a href="/workshops/strangling_the_monolith/">Microservices Workshop - Strangling the Monolith</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_4_101/">OpenShift 4 101</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_4_101_dynatrace/">OpenShift 4 101 w/Dynatrace</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_serverless/">OpenShift Serverless</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_service_mesh/">OpenShift Service Mesh</a>
                  </li>
                
                  <li>
                    <a href="/workshops/rhel_8/">Red Hat Enterprise Linux 8</a>
                  </li>
                
                  <li>
                    <a href="/workshops/selinux_policy/">SELinux Policy Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_service_mesh_v1.0/">zOpenShift Service Mesh</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                alpha <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                
                  <li>
                    <a href="/workshops/alpha/ansible_with_rhocp_edge/">Applied Ansible Automation - Containerized Edge Workshop</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Retired <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                
                  <li>
                    <a href="/workshops/ansible_tower_azure/">Ansible Tower Workshop on Azure</a>
                  </li>
                
                  <li>
                    <a href="/workshops/cloudforms41/">CloudForms Workshops</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_containers/">Container Security Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/jdv_dev/">JBoss Data Virtualization Development</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_101_dcmetromap/">OpenShift 101 - DC Metro Map Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_openshift/">OpenShift Security Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/rhosp_101/">Red Hat OpenStack Platform 101</a>
                  </li>
                
                  <li>
                    <a href="/workshops/source_to_image/">Source to Image</a>
                  </li>
                
              </ul>
            </li>
          
        
      </ul>
    </div>
  </div>
</nav>



<div class="jumbotron jumbotron-page text-center">
  <h1></h1>
</div>

<div class="container">
  

<h1 id="unit-5-cli-tools">Unit 5: CLI tools</h1>

<p>In this unit you will access the Certificate System using various command-line interface (CLI) tools. Red Hat Certificate System provides a client command-line interface to access various services on the server.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Your environment needs to be configured to use the ca_admin certificate to interact with the subsystems via the CLI. The root user does not have be to used but access to /root/.dogtag is required to use the ca_admin certificate.</p>

<ol>
<li><p>Store the passwords in a text file. The default passwords are <strong>redhat</strong>.</p>

<p><code>echo redhat &gt; ~/.dogtag/ca1/client_password.txt</code></p>

<p><code>echo redhat &gt; ~/.dogtag/ca1/pkcs12_password.txt</code></p></li>

<li><p>Initialize nssdb if it does not exist.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt client-init</code></p></li>

<li><p>Import ca_admin certificate.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt \
client-cert-import \
--pkcs12 ~/.dogtag/ca1/ca_admin_cert.p12 \
--pkcs12-password-file ~/.dogtag/ca1/pkcs12_password.txt</code></p></li>
</ol>

<h2 id="certutil">certutil</h2>

<p>The Certificate Database Tool, <strong>certutil</strong>, is a command-line utility that can create and modify certificate and key databases. It can specifically list, generate, modify, or delete certificates, create or change the password, generate new public and private key pairs, display the contents of the key database, or delete key pairs within the key database.</p>

<ol>
<li><p>List all certificates.</p>

<p><code>certutil -L -d /var/lib/pki/ca1/alias/ -h all</code></p></li>

<li><p>Show certificate (human-readable).</p>

<p><code>certutil -L -d /var/lib/pki/ca1/alias/ -n &quot;caSigningCert cert-ca1 CA&quot;</code></p></li>

<li><p>Show certificate (ASCII).</p>

<p><code>certutil -L -d /var/lib/pki/ca1/alias/ -n &quot;caSigningCert cert-ca1 CA&quot; -a</code></p></li>

<li><p>Output certificate to file.</p>

<p><code>certutil -L -d /var/lib/pki/ca1/alias/ -n &quot;caSigningCert cert-ca1 CA&quot; -a -o output.crt</code></p></li>

<li><p>List keys (Internal password is in /etc/pki/ca1/password.conf).</p>

<p><code>certutil -K -d /var/lib/pki/ca1/alias/</code></p></li>

<li><p>More documentation can be found in <code>man certutil</code> and the <a href="https://access.redhat.com/documentation/en-us/red_hat_directory_server/9.0/html/administration_guide/managing_ssl-using_certutil">RHDS Administration Guide</a>.</p></li>
</ol>

<h2 id="pki">pki</h2>

<p>The pki command provides a command-line interface allowing clients to access various services on the Certificate System server.   These  services  include  certificates, groups, keys, security domains, and users.</p>

<h3 id="show-users-using-pki">Show users using pki</h3>

<ol>
<li><p>List CA users. Accept default answers.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; ca-user-find</code></p></li>

<li><p>List KRA users.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; kra-user-find</code></p></li>

<li><p>List OCSP users.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; ocsp-user-find</code></p></li>

<li><p>List TKS users.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; tks-user-find</code></p></li>

<li><p>List TPS users.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; tps-user-find</code></p></li>
</ol>

<h3 id="show-groups-using-pki">Show groups using pki</h3>

<ol>
<li><p>List CA groups.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; ca-group-find</code></p></li>

<li><p>List KRA groups.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; kra-group-find</code></p></li>

<li><p>List OCSP groups.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; ocsp-group-find</code></p></li>

<li><p>List TKS groups.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; tks-group-find</code></p></li>

<li><p>List TPS groups.</p>

<p><code>pki -C ~/.dogtag/ca1/client_password.txt -n &quot;PKI Administrator for redhat.example.com&quot; tps-group-find</code></p></li>
</ol>

<h2 id="pki-server">pki-server</h2>

<p>The pki-server command provides a command-line interface allowing administrators to perform various administrative operations on the Certificate System instances. These services include starting/stopping instances, enabling/disabling subsystems, performing certain migrations and enabling/disabling startup using nuxwdog.</p>

<p>Operations are performed using file system utilities, and can only be performed by an administrative user on the local host. This utility does not connect to any of the subsystem's WEB or REST interfaces.</p>

<h3 id="pki-server-instance-commands">pki-server instance commands</h3>

<ol>
<li><p>Show instances.</p>

<p><code>pki-server instance-find</code></p></li>

<li><p>Stop instance.</p>

<p><code>pki-server instance-stop ca1</code></p></li>

<li><p>Start instance.</p>

<p><code>pki-server instance-start ca1</code></p></li>
</ol>

<h3 id="pki-server-subsystem-commands">pki-server subsystem commands</h3>

<ol>
<li><p>List subsystems.</p>

<p><code>pki-server subsystem-find -i ca1</code></p></li>

<li><p>List subsystem certs.</p>

<p><code>pki-server subsystem-cert-find -i ca1 ca</code></p></li>

<li><p>Show details of certificate.</p>

<p><code>pki-server subsystem-cert-show -i ca1 ca sslserver --show-all</code></p></li>

<li><p>Disable subsystem.</p>

<p><code>pki-server subsystem-disable -i ca1 ocsp</code></p></li>

<li><p>Enable subsystem.</p>

<p><code>pki-server subsystem-enable -i ca1 ocsp</code></p></li>
</ol>

<h2 id="pkidaemon">pkidaemon</h2>

<p>The pkidaemon command with the 'status' argument provides a way to display the status of all existing PKI instances on a machine. Optionally, an individual PKI instance may be specified by using an optional [instance-name].</p>

<p>The pkidaemon 'start' argument is currently only used internally by the systemctl scripts.</p>

<ol>
<li><p>Show status of instance.</p>

<p><code>pkidaemon status ca1</code></p>
<pre><code>[CA Status Definitions]
Unsecure URL        = http://ca1.redhat.example.com:8080/ca/ee/ca
Secure Agent URL    = https://ca1.redhat.example.com:8443/ca/agent/ca
Secure EE URL       = https://ca1.redhat.example.com:8443/ca/ee/ca
Secure Admin URL    = https://ca1.redhat.example.com:8443/ca/services
PKI Console Command = pkiconsole https://ca1.redhat.example.com:8443/ca
Tomcat Port         = 8005 (for shutdown)

[KRA Status Definitions]
Secure Agent URL    = https://ca1.redhat.example.com:8443/kra/agent/kra
Secure Admin URL    = https://ca1.redhat.example.com:8443/kra/services
PKI Console Command = pkiconsole https://ca1.redhat.example.com:8443/kra
Tomcat Port         = 8005 (for shutdown)

[OCSP Status Definitions]
Unsecure URL        = http://ca1.redhat.example.com:8080/ocsp/ee/ocsp/&lt;ocsp request blob&gt;
Secure Agent URL    = https://ca1.redhat.example.com:8443/ocsp/agent/ocsp
Secure EE URL       = https://ca1.redhat.example.com:8443/ocsp/ee/ocsp/&lt;ocsp request blob&gt;
Secure Admin URL    = https://ca1.redhat.example.com:8443/ocsp/services
PKI Console Command = pkiconsole https://ca1.redhat.example.com:8443/ocsp
Tomcat Port         = 8005 (for shutdown)

[TKS Status Definitions]
Secure Agent URL    = https://ca1.redhat.example.com:8443/tks/agent/tks
Secure Admin URL    = https://ca1.redhat.example.com:8443/tks/services
PKI Console Command = pkiconsole https://ca1.redhat.example.com:8443/tks
Tomcat Port         = 8005 (for shutdown)

[TPS Status Definitions]
Unsecure URL        = http://ca1.redhat.example.com:8080/tps
Secure URL          = https://ca1.redhat.example.com:8443/tps
Unsecure PHONE HOME = http://ca1.redhat.example.com:8080/tps/phoneHome
Secure PHONE HOME   = https://ca1.redhat.example.com:8443/tps/phoneHome
Tomcat Port         = 8005 (for shutdown)

[CA Configuration Definitions]
PKI Instance Name:   ca1

PKI Subsystem Type:  Root CA (Security Domain)

Registered PKI Security Domain Information:
==========================================================================
Name:  redhat.example.com Security Domain
URL:   https://ca1.redhat.example.com:8443
==========================================================================

[KRA Configuration Definitions]
PKI Instance Name:   ca1

PKI Subsystem Type:  KRA

Registered PKI Security Domain Information:
==========================================================================
Name:  redhat.example.com Security Domain
URL:   https://ca1.redhat.example.com:8443
==========================================================================

[OCSP Configuration Definitions]
PKI Instance Name:   ca1

PKI Subsystem Type:  OCSP

Registered PKI Security Domain Information:
==========================================================================
Name:  redhat.example.com Security Domain
URL:   https://ca1.redhat.example.com:8443
==========================================================================

[TKS Configuration Definitions]
PKI Instance Name:   ca1

PKI Subsystem Type:  TKS

Registered PKI Security Domain Information:
==========================================================================
Name:  redhat.example.com Security Domain
URL:   https://ca1.redhat.example.com:8443
==========================================================================

[TPS Configuration Definitions]
PKI Instance Name:   ca1

PKI Subsystem Type:  TPS

Registered PKI Security Domain Information:
==========================================================================
Name:  redhat.example.com Security Domain
URL:   https://ca1.redhat.example.com:8443
==========================================================================</code></pre></li>
</ol>

<p>The next lesson is <a href="https://gitlab.consulting.redhat.com/pki/pki-workshop/blob/master/unit_lessons/unit_6.md">Unit 6: Issuing a certificate</a>.</p>

</div>



    <div id="page-footer" class="container">
      <p class="text-center">
        Copyright &copy; 2023 Red Hat, Inc.
      </p>
    </div>
    <script type="text/javascript">
      if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
      }
    </script>
  </body>
</html>

