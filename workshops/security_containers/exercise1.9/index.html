<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Exercise 1.9 - Linux Kernel Capabilities | Red Hat | Public Sector</title>

    
    
    <link rel="stylesheet" href="/node_modules/patternfly/dist/css/patternfly.min.css" />
    <link rel="stylesheet" href="/node_modules/patternfly/dist/css/patternfly-additions.min.css" />

    
    <link rel="stylesheet" href="/node_modules/highlight.js/styles/darkula.css" />

    
    <link rel="stylesheet" href="/css/main.css" />
    <link rel="stylesheet" href="/css/asciidoc.css" />
    <link rel="stylesheet" href="/css/custom.css" />
    <link rel="stylesheet" href="/css/toastr.min.css" />

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DL741MBBZQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DL741MBBZQ');
    </script>

    
    <script id="adobe_dtm" src="//www.redhat.com/dtm.js" type="text/javascript"></script>

    
    <script src="/node_modules/patternfly/node_modules/jquery/dist/jquery.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/c3/c3.min.js"></script>
    <script src="/node_modules/patternfly/node_modules/d3/d3.min.js"></script>

    
    
    <script src="/node_modules/patternfly/node_modules/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="/node_modules/patternfly/node_modules/drmonty-datatables-colvis/js/dataTables.colVis.js"></script>
    <script src="/node_modules/patternfly/node_modules/datatables.net-colreorder/js/dataTables.colReorder.js"></script>

    
    
    <script src="/node_modules/patternfly/dist/js/patternfly.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/patternfly-bootstrap-combobox/js/bootstrap-combobox.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/moment/min/moment.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-select/dist/js/bootstrap-select.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/patternfly-bootstrap-treeview/dist/bootstrap-treeview.min.js"></script>

    
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

    
    <script src="/node_modules/patternfly/node_modules/jquery-match-height/dist/jquery.matchHeight-min.js"></script>
    
    <script src="/js/clipboard.min.js"></script>
    <script src="/js/clip.js"></script>

    
    <script src="/js/toastr.min.js"></script>

    
    <script src="/node_modules/highlight.js/lib/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body class="">
    

<nav class="navbar navbar-default navbar-inverse navbar-fixed-top " role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
      <svg width=150 height=auto id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 613 145"><defs><style>.cls-1{fill:#e00;}.cls-2{fill:#fff;}</style></defs><path class="cls-1" d="M127.47,83.49c12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89,8.69,103.76.5,97.51.5,91.69.5,90,8,83.06,8c-6.68,0-11.64-5.6-17.89-5.6-6,0-9.91,4.09-12.93,12.5,0,0-8.41,23.72-9.49,27.16A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33C22.27,52,.5,55,.5,74.22c0,31.48,74.59,70.28,133.65,70.28,45.28,0,56.7-20.48,56.7-36.65,0-12.72-11-27.16-30.83-35.78"/><path d="M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33l3.66-9.06A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45,12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42Z"/><path class="cls-2" d="M579.74,92.8c0,11.89,7.15,17.67,20.19,17.67a52.11,52.11,0,0,0,11.89-1.68V95a24.84,24.84,0,0,1-7.68,1.16c-5.37,0-7.36-1.68-7.36-6.73V68.3h15.56V54.1H596.78v-18l-17,3.68V54.1H568.49V68.3h11.25Zm-53,.32c0-3.68,3.69-5.47,9.26-5.47a43.12,43.12,0,0,1,10.1,1.26v7.15a21.51,21.51,0,0,1-10.63,2.63c-5.46,0-8.73-2.1-8.73-5.57m5.2,17.56c6,0,10.84-1.26,15.36-4.31v3.37h16.82V74.08c0-13.56-9.14-21-24.39-21-8.52,0-16.94,2-26,6.1l6.1,12.52c6.52-2.74,12-4.42,16.83-4.42,7,0,10.62,2.73,10.62,8.31v2.73a49.53,49.53,0,0,0-12.62-1.58c-14.31,0-22.93,6-22.93,16.73,0,9.78,7.78,17.24,20.19,17.24m-92.44-.94h18.09V80.92h30.29v28.82H506V36.12H487.93V64.41H457.64V36.12H439.55ZM370.62,81.87c0-8,6.31-14.1,14.62-14.1A17.22,17.22,0,0,1,397,72.09V91.54A16.36,16.36,0,0,1,385.24,96c-8.2,0-14.62-6.1-14.62-14.09m26.61,27.87h16.83V32.44l-17,3.68V57.05a28.3,28.3,0,0,0-14.2-3.68c-16.19,0-28.92,12.51-28.92,28.5a28.25,28.25,0,0,0,28.4,28.6,25.12,25.12,0,0,0,14.93-4.83ZM320,67c5.36,0,9.88,3.47,11.67,8.83H308.47C310.15,70.3,314.36,67,320,67M291.33,82c0,16.2,13.25,28.82,30.28,28.82,9.36,0,16.2-2.53,23.25-8.42l-11.26-10c-2.63,2.74-6.52,4.21-11.14,4.21a14.39,14.39,0,0,1-13.68-8.83h39.65V83.55c0-17.67-11.88-30.39-28.08-30.39a28.57,28.57,0,0,0-29,28.81M262,51.58c6,0,9.36,3.78,9.36,8.31S268,68.2,262,68.2H244.11V51.58Zm-36,58.16h18.09V82.92h13.77l13.89,26.82H292l-16.2-29.45a22.27,22.27,0,0,0,13.88-20.72c0-13.25-10.41-23.45-26-23.45H226Z"/></svg>
      </a>
    </div>
    <div class="collapse navbar-collapse navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        
        
          
            <li>
              <a href="/">Home</a>
            </li>
          
        
          
            <li>
              <a href="/about/">About</a>
            </li>
          
        
          
            <li>
              <a href="/contact/">Contact</a>
            </li>
          
        
          
            <li>
              <a href="https://www.redhat.com/en/events">Events</a>
            </li>
          
        
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Workshops <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                
                  <li>
                    <a href="/workshops/agile_integrations_ci/">Agile Integrations Workshop - Citizen Integrator</a>
                  </li>
                
                  <li>
                    <a href="/workshops/agile_integrations_dev/">Agile Integrations Workshop - Developer</a>
                  </li>
                
                  <li>
                    <a href="/workshops/ansible_automation/">Ansible Automation Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/ansible_tower_intro/">Ansible Tower - an Introduction</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_container_intro/">Container Security - A Practical Introduction</a>
                  </li>
                
                  <li>
                    <a href="/workshops/containers_101/">Containers 101 Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/secure_software_factory/">DevSecOps Workshop - Secure Software Factory</a>
                  </li>
                
                  <li>
                    <a href="/workshops/containers_the_hard_way/">Linux Containers the Hard Way</a>
                  </li>
                
                  <li>
                    <a href="/workshops/strangling_the_monolith/">Microservices Workshop - Strangling the Monolith</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_4_101/">OpenShift 4 101</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_4_101_dynatrace/">OpenShift 4 101 w/Dynatrace</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_serverless/">OpenShift Serverless</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_service_mesh/">OpenShift Service Mesh</a>
                  </li>
                
                  <li>
                    <a href="/workshops/rhel_8/">Red Hat Enterprise Linux 8</a>
                  </li>
                
                  <li>
                    <a href="/workshops/selinux_policy/">SELinux Policy Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_service_mesh_v1.0/">zOpenShift Service Mesh</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                alpha <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                
                  <li>
                    <a href="/workshops/alpha/ansible_with_rhocp_edge/">Applied Ansible Automation - Containerized Edge Workshop</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Retired <b class="caret"></b>
              </a>
              <ul class="dropdown-menu">
                
                  <li>
                    <a href="/workshops/ansible_tower_azure/">Ansible Tower Workshop on Azure</a>
                  </li>
                
                  <li>
                    <a href="/workshops/cloudforms41/">CloudForms Workshops</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_containers/">Container Security Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/jdv_dev/">JBoss Data Virtualization Development</a>
                  </li>
                
                  <li>
                    <a href="/workshops/openshift_101_dcmetromap/">OpenShift 101 - DC Metro Map Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/security_openshift/">OpenShift Security Workshop</a>
                  </li>
                
                  <li>
                    <a href="/workshops/rhosp_101/">Red Hat OpenStack Platform 101</a>
                  </li>
                
                  <li>
                    <a href="/workshops/source_to_image/">Source to Image</a>
                  </li>
                
              </ul>
            </li>
          
        
      </ul>
    </div>
  </div>
</nav>



<div class="jumbotron jumbotron-page text-center">
  <h1>Exercise 1.9 - Linux Kernel Capabilities</h1>
</div>

<div class="container">
  <div class="row">
    <p class="text-center">
      
      <a href="/workshops/security_containers">Return to Workshop</a>
    </p>

    








<nav>
  <ul class="pager">
    
    
    <li class="previous">
      <a href="/workshops/security_containers/exercise1.8/">&larr; Previous: Exercise 1.8 - SELinux</a>
    </li>
    
    
    
    
    <li class="next">
      <a href="/workshops/security_containers/wrapup/">Next: Wrap Up &rarr;</a>
    </li>
    
    
  </ul>
</nav>

    <div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/workshops/security_containers/images/kernel.png" alt="kernel"/>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_exercise_1_9_linux_kernel_capabilities">Exercise 1.9 - Linux Kernel Capabilities</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_exercise_description">Exercise Description</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this exercise, we will examine Linux capabilities: how they are defined, their purpose,and how they affect security.</p>
</div>
<div class="paragraph">
<p><strong>Linux Capabilities Defined</strong></p>
</div>
<div class="paragraph">
<p>According to the capabilities man page;</p>
</div>
<div class="paragraph">
<p><em>Capabilities are distinct units of privilege that can be independently enabled
or disabled.</em></p>
</div>
<div class="paragraph">
<p>Capabilities were added to the kernel around 15 or so years ago, to try to
divide up the power of root. Originally the kernel allocated a 32-bit bitmask
to define these capabilities. A few years ago it was expanded to 64. There are
currently approximately 38 defined capabilities.</p>
</div>
<div class="paragraph">
<p>Capabilities are things like the ability to send raw IP packets, change
hostnames or bind to ports below 1024. When we run containers we can drop a
whole bunch of capabilities before running our containers, without causing the
vast majority of containerized applications to fail.</p>
</div>
<div class="paragraph">
<p>Most capabilities are required to manipulate the kernel/system, and these are
used by the container framework, but seldom used by the processes
running inside the container. However, some containers require a few
capabilities, for example a container process needs capabilities like
setuid/setgid to drop privileges. As with most things in the container world,
we try to establish a compromise between security and the ability to be efficient.</p>
</div>
<div class="paragraph">
<p>Luckily we also use additional tools like
<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/SELinux_Users_and_Administrators_Guide/">SELinux</a>,
<a href="https://en.wikipedia.org/wiki/Seccomp">seccomp</a>, and
<a href="http://rhelblog.redhat.com/2015/07/07/whats-next-for-containers-user-namespaces/">namespaces</a>
to protect the host system from the containers.</p>
</div>
<div class="paragraph">
<p><strong>Bottom line: Dropping more of the capabilities from your container is a good
idea from a security point of view.</strong></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_section_1_linux_capabilities">Section 1: Linux Capabilities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_step_1_view_process_capabilities">Step 1. View process capabilities</h3>
<div class="paragraph">
<p>So, how can we drop these capabilities for containers? First, let’s see what
capabilities a process has. There is a cool tool in Linux that can help you
view what capabilities a process has called <code>pscap</code>, available in the
<code>libcap-ng-utils</code> package on Fedora.</p>
</div>
<div class="listingblock">
<div class="title">See current processes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pscap | head -10</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">See processes of a normal container</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo podman run -d fedora sleep 5 &gt;/dev/null; pscap | grep sleep</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_drop_specific_capabilities_blacklisting">Step 2. Drop specific capabilities (Blacklisting)</h3>
<div class="paragraph">
<p>If I wanted to drop <code>setfcap</code>, <code>audit_write</code>, and <code>mknod</code>, I could use
<code>--cap-drop=setfcap</code>  <code>--cap-drop=audit_write</code> <code>--cap-drop=mknod</code>:</p>
</div>
<div class="listingblock">
<div class="title">Dropping setfcap, audit_write, mknod</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo podman run -d --cap-drop=setfcap --cap-drop=audit_write --cap-drop=mknod \
fedora sleep 5 &gt; /dev/null; pscap | grep sleep</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_drop_all_capabilities_and_add_specific_ones_back_in_whitelisting">Step 3. Drop all capabilities and add specific ones back in. (Whitelisting)</h3>
<div class="paragraph">
<p>Better yet, if you know your container only needs setuid and setgid, you can
drop all capabilities and just add setgid and setuid back in.</p>
</div>
<div class="listingblock">
<div class="title">Whitelisting Capabilities</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo podman run -d --cap-drop=all --cap-add=setuid --cap-add=setgid \
fedora sleep 5 &gt; /dev/null; pscap | grep sleep</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following bellow is a comparison of the output form blacklisting vs.
whitelisting.</p>
</div>
<div class="listingblock">
<div class="title">Compare the output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">chown, dac_override, fowner, fsetid, kill, setgid, setuid,
setpcap, net_bind_service, net_raw, sys_chroot <i class="conum" data-value="1"></i><b>(1)</b>

vs.

setgid, setuid <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tbody><tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Blacklisting: Specifying each capability you want to drop.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Whitelisting: Dropping all and adding back the ones you need.</td>
</tr>
</tbody></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_section_2_deep_dive_into_capabilities">Section 2: Deep Dive into Capabilities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lets look deeper into each of these Linux Capabilities.</p>
</div>
<div class="paragraph">
<p><div class="panel-group">
  

<div class="panel panel-default">
  <div class="panel-heading">
    <h4 class="panel-title">
      
      <a data-toggle="collapse" href="#collapsea05573d53739e9ed6f730f909014bb20" class="collapsed">
      
        Linux Capabilities
      </a>
    </h4>
  </div>
  
  <div id="collapsea05573d53739e9ed6f730f909014bb20" class="panel-collapse collapse ">
  
    <div class="panel-body">
       <div class="paragraph">
<p><code><strong>chown</strong></code></p>
</div>
<div class="paragraph">
<p>The man page describes chown as the ability to make arbitrary changes to file
UIDs and GIDs.</p>
</div>
<div class="paragraph">
<p>This means that root can change the ownership or group of any file system
object. If you are not running a shell within a container and not installing
packages into the container, you should drop this capability.</p>
</div>
<div class="paragraph">
<p>I would make the argument this should never be needed in production. If you
need to chown, allow the capability, do the work, then take it away.</p>
</div>
<div class="paragraph">
<p><code><strong>dac_override</strong></code></p>
</div>
<div class="paragraph">
<p>The man page says that dac_override allows root to bypass file read, write, and
execute permission checks. DAC is an abbreviation of “discretionary access
control”.</p>
</div>
<div class="paragraph">
<p>This means a root capable process can read, write, and execute any file on the
system, even if the permission and ownership fields would not allow it. Almost
no apps need DAC_OVERRIDE, and if they do they are probably doing something
wrong. There are probably less than ten in the whole distribution that actually
need it. Of course the administrator shell could require DAC_OVERRIDE fixing
bad permissions in the file system.</p>
</div>
<div class="paragraph">
<p>Steve Grubb, security standards expert at Red Hat, says that “nothing should
need this. If your container needs this, it’s probably doing something
horrible.”</p>
</div>
<div class="paragraph">
<p><code><strong>fowner</strong></code></p>
</div>
<div class="paragraph">
<p>According to the man page, fowner conveys the ability to bypass permission
checks on operations that normally require the file system UID of the process to
match the UID of the file. For example, chmod and utime, and excludes
operations covered by cap_dac_override and cap_dac_read_search. Here’s more
from the man page:</p>
</div>
<div class="paragraph">
<p>set extended file attributes (see chattr(1)) on arbitrary files;
set Access Control Lists (ACLs) on arbitrary files;
ignore directory sticky bit on file deletion;
specify O_NOATIME for arbitrary files in open(2) and fcntl(2).
This is similar to DAC_OVERRIDE, almost no applications need this other than,
potentially, software installation tools. Most likely your container would run
fine without this capability. You might need to allow this for a container build but it should be blocked when you run your container in production.</p>
</div>
<div class="paragraph">
<p><code><strong>fsetid</strong></code></p>
</div>
<div class="paragraph">
<p>The man page says “don’t clear set-user-ID and set-group-ID mode bits when a
file is modified; set the set-group-ID bit for a file whose GID does not match
the file system or any of the supplementary GIDs of the calling process.”</p>
</div>
<div class="paragraph">
<p><strong>My take: If you are not running an installation, you probably do not need this
capability. I would disable this one by default.</strong></p>
</div>
<div class="paragraph">
<p><code><strong>kill</strong></code></p>
</div>
<div class="paragraph">
<p>If a process has this capability it can override the restriction that “the real
or effective user ID, of a process sending a signal, must match the real or
effective user ID of the process receiving the signal.”</p>
</div>
<div class="paragraph">
<p>This capability basically means that a root-owned process can send kill signals
to non-root processes. If your container is running all processes as root, or
the root processes never kills processes running as non root, you do not need
this capability. If you are running systemd as PID 1 inside of a container and
you want to stop a container running with a different UID you might need this
capability.</p>
</div>
<div class="paragraph">
<p>It’s probably also worth mentioning on the danger scale, this one is on the low
end.</p>
</div>
<div class="paragraph">
<p><code><strong>setgid</strong></code></p>
</div>
<div class="paragraph">
<p>The man page says that the setgid capability lets a process make arbitrary
manipulations of process GIDs and supplementary GID list. It can also forge GID
when passing socket credentials via UNIX domain sockets or write a group ID
mapping in a user namespace. See user_namespaces(7) for more information.</p>
</div>
<div class="paragraph">
<p>In short, a process with this capability can change its GID to any other GID.
Basically allows full group access to all files on the system. If your
container processes do not change UIDs/GIDs, they do not need this capability.</p>
</div>
<div class="paragraph">
<p><code><strong>setuid</strong></code></p>
</div>
<div class="paragraph">
<p>If a process has the setuid capability it can “make arbitrary manipulations of
process UIDs (setuid(2), setreuid(2), setresuid(2), setfsuid(2)); forge UID
when passing socket credentials via UNIX domain sockets; write a user ID
mapping in a user namespace (see user_namespaces(7)).”</p>
</div>
<div class="paragraph">
<p>A process with this capability can change its UID to any other UID. Basically,
it allows full access to all files on the system. If your container processes
do not change UIDs/GIDs always running as the same UID, preferably non root,
they do not need this capability. Applications that need setuid usually
start as root, in order to bind to ports below 1024 and then change their UIDS
and drop capabilities. Apache binding to Port 80 requires net_bind_service,
usually starting as root. It then needs setuid/setgid to switch to the apache
user and drop capabilities.</p>
</div>
<div class="paragraph">
<p>Most containers can safely drop setuid/setgid capability.</p>
</div>
<div class="paragraph">
<p><code><strong>setpcap</strong></code></p>
</div>
<div class="paragraph">
<p>Let’s look at the man page description: “Add any capability from the calling
thread’s bounding set to its inheritable set; drop capabilities from the
bounding set (via prctl(2) PR_CAPBSET_DROP); make changes to the securebits
flags.”</p>
</div>
<div class="paragraph">
<p>In layman’s terms, a process with this capability can change its current
capability set within its bounding set. Meaning a process could drop
capabilities or add capabilities if it did not currently have them, but limited
by the bounding set capabilities.</p>
</div>
<div class="paragraph">
<p><code><strong>net_bind_service</strong></code></p>
</div>
<div class="paragraph">
<p>This one’s easy. If you have this capability, you can bind to privileged ports
(e.g., those below 1024).</p>
</div>
<div class="paragraph">
<p>If you want to bind to a port below 1024 you need this capability. If you are
running a service that listens to a port above 1024 you should drop this
capability.</p>
</div>
<div class="paragraph">
<p>The risk of this capability is a rogue process interpreting a service like sshd,
and collecting users passwords. Running a container in a different network
namespace reduces the risk of this capability. It would be difficult for the
container process to get to the public network interface</p>
</div>
<div class="paragraph">
<p><code><strong>net_raw</strong></code></p>
</div>
<div class="paragraph">
<p>The man page says, “allow use of RAW and PACKET sockets. Allow binding to any
address for transparent proxying.”</p>
</div>
<div class="paragraph">
<p>This access allows a process to spy on packets on its network. That’s bad,
right? Most container processes would not need this access so it probably
should be dropped. Note this would only affect the containers that share the
same network that your container process is running on, usually preventing
access to the real network.</p>
</div>
<div class="paragraph">
<p>RAW sockets also give an attacker the ability to inject scary things onto the
network. Depending on what you are doing with the ping command, it could
require this access.</p>
</div>
<div class="paragraph">
<p><code><strong>sys_chroot</strong></code></p>
</div>
<div class="paragraph">
<p>This capability allows use of chroot(). In other words, it allows your
processes to chroot into a different rootfs. chroot is probably not used within
your container, so it should be dropped.</p>
</div>
<div class="paragraph">
<p><code><strong>mknod</strong></code></p>
</div>
<div class="paragraph">
<p>If you have this capability, you can create special files using mknod.</p>
</div>
<div class="paragraph">
<p>This allows your processes to create device nodes. Containers are usually
provided all of the device nodes they need in /dev, the creation of device
nodes is controlled by the device node cgroup, but I really think this should
be dropped by default. Almost no containers ever do this, and even fewer
containers should do this.</p>
</div>
<div class="paragraph">
<p><code><strong>audit_write</strong></code></p>
</div>
<div class="paragraph">
<p>If you have this one, you can write a message to kernel auditing log. Few
processes attempt to write to the audit log (login programs, su, sudo) and
processes inside of the container are probably not trusted. The audit subsystem
is not currently namespace aware, so this should be dropped by default.</p>
</div>
<div class="paragraph">
<p><code><strong>setfcap</strong></code></p>
</div>
<div class="paragraph">
<p>Finally, the setfcap capability enables you to set file capabilities on a file
system. Might be needed for doing installs during builds, but in production it
should probably be dropped.</p>
</div>

    </div>
  </div>
</div>


</div>

<style>

 
.modal {
  display: none;  
  position: fixed;  
  z-index: 1;  
  left: 0;
  top: 0;
  width: 100%;  
  height: 100%;  
  overflow: auto;  
  background-color: rgb(0,0,0);  
  background-color: rgba(0,0,0,0.4);  
  -webkit-animation-name: fadeIn;  
  -webkit-animation-duration: 0.4s;
  animation-name: fadeIn;
  animation-duration: 0.4s
}

 
.modal-content {
  position: fixed;
  bottom: 0;
  background-color: #fefefe;
  width: 100%;
  -webkit-animation-name: slideIn;
  -webkit-animation-duration: 0.4s;
  animation-name: slideIn;
  animation-duration: 0.4s
}

 
.close {
  color: white;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}

.modal-header {
  padding: 2px 16px;
  background-color: #000000;
  color: white;
}

.modal-body {padding: 2px 16px;}

.modal-footer {
  padding: 2px 16px;
  background-color: #000000;
  color: white;
}

 
@-webkit-keyframes slideIn {
  from {bottom: -300px; opacity: 0}
  to {bottom: 0; opacity: 1}
}

@keyframes slideIn {
  from {bottom: -300px; opacity: 0}
  to {bottom: 0; opacity: 1}
}

@-webkit-keyframes fadeIn {
  from {opacity: 0}
  to {opacity: 1}
}

@keyframes fadeIn {
  from {opacity: 0}
  to {opacity: 1}
}
</style>

<div id="myModal" class="modal">

  
  <div class="modal-content">
    <div class="modal-header">
      <span class="close">&times;</span>
      <h3>Workshop Details</h3>
    </div>
    <div class="modal-body">
<div class="row">
  <div class="col-lg-4 col-md-5 col-sm-12" id="workshopFooterDetails">
    <table>
      <tr>
        <td class="text-right"><b>Domain</b></td>
        <td><span class="domain"></span></td>
        <td rowspan="3">
        <img src="/images/Logo-Red_Hat-C-Standard-RGB-small.png" alt="Red Hat Logo" />
        </td>
      </tr>
      <tr>
        <td class="text-right"><b>Workshop</b></td>
        <td><span class="prefix"></span></td>
      </tr>
      <tr>
        <td class="text-right"><b>Student ID</b></td>
        <td><span class="userid"></span></td>
      </tr>
    </table>
  </div>
  <div class="col-lg-8 col-md-7 col-sm-12">
    <form id="footerForm" onsubmit="return false;" class="row" style="padding: 1.75rem 0 0 0;">
      <div class="form-group col-sm-6 col-md-6 col-lg-2">
        <label for="userid">Student ID</label>
        <select id="userid" name="userid">
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
          <option value="6">6</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
          <option value="13">13</option>
          <option value="14">14</option>
          <option value="15">15</option>
          <option value="16">16</option>
          <option value="17">17</option>
          <option value="18">18</option>
          <option value="19">19</option>
          <option value="20">20</option>
          <option value="21">21</option>
          <option value="22">22</option>
          <option value="23">23</option>
          <option value="24">24</option>
          <option value="25">25</option>
          <option value="26">26</option>
          <option value="27">27</option>
          <option value="28">28</option>
          <option value="29">29</option>
          <option value="30">30</option>
          <option value="31">31</option>
          <option value="32">32</option>
          <option value="33">33</option>
          <option value="34">34</option>
          <option value="35">35</option>
          <option value="36">36</option>
          <option value="37">37</option>
          <option value="38">38</option>
          <option value="39">39</option>
          <option value="40">40</option>
          <option value="41">41</option>
          <option value="42">42</option>
          <option value="43">43</option>
          <option value="44">44</option>
          <option value="45">45</option>
          <option value="46">46</option>
          <option value="47">47</option>
          <option value="48">48</option>
          <option value="49">49</option>
          <option value="50">50</option>
          <option value="51">51</option>
          <option value="52">52</option>
          <option value="53">53</option>
          <option value="54">54</option>
          <option value="55">55</option>
          <option value="56">56</option>
          <option value="57">57</option>
          <option value="58">58</option>
          <option value="59">59</option>
          <option value="60">60</option>
          <option value="61">61</option>
          <option value="62">62</option>
          <option value="63">63</option>
          <option value="64">64</option>
          <option value="65">65</option>
          <option value="66">66</option>
          <option value="67">67</option>
          <option value="68">68</option>
          <option value="69">69</option>
          <option value="70">70</option>
          <option value="71">71</option>
          <option value="72">72</option>
          <option value="73">73</option>
          <option value="74">74</option>
          <option value="75">75</option>
          <option value="76">76</option>
          <option value="77">77</option>
          <option value="78">78</option>
          <option value="79">79</option>
          <option value="80">80</option>
          <option value="81">81</option>
          <option value="82">82</option>
          <option value="83">83</option>
          <option value="84">84</option>
          <option value="85">85</option>
          <option value="86">86</option>
          <option value="87">87</option>
          <option value="88">88</option>
          <option value="89">89</option>
          <option value="90">90</option>
          <option value="91">91</option>
          <option value="92">92</option>
          <option value="93">93</option>
          <option value="94">94</option>
          <option value="95">95</option>
          <option value="96">96</option>
          <option value="97">97</option>
          <option value="98">98</option>
          <option value="99">99</option>
          <option value="100">100</option>
          <option value="101">101</option>
          <option value="102">102</option>
          <option value="103">103</option>
          <option value="104">104</option>
          <option value="105">105</option>
          <option value="106">106</option>
          <option value="107">107</option>
          <option value="108">108</option>
          <option value="109">109</option>
          <option value="110">110</option>
          <option value="111">111</option>
          <option value="112">112</option>
          <option value="113">113</option>
          <option value="114">114</option>
          <option value="115">115</option>
          <option value="116">116</option>
          <option value="117">117</option>
          <option value="118">118</option>
          <option value="119">119</option>
          <option value="120">120</option>
          <option value="121">121</option>
          <option value="122">122</option>
          <option value="123">123</option>
          <option value="124">124</option>
          <option value="125">125</option>
          <option value="126">126</option>
          <option value="127">127</option>
          <option value="128">128</option>
          <option value="129">129</option>
          <option value="130">130</option>
          <option value="131">131</option>
          <option value="132">132</option>
          <option value="133">133</option>
          <option value="134">134</option>
          <option value="135">135</option>
          <option value="136">136</option>
          <option value="137">137</option>
          <option value="138">138</option>
          <option value="139">139</option>
          <option value="140">140</option>
          <option value="141">141</option>
          <option value="142">142</option>
          <option value="143">143</option>
          <option value="144">144</option>
          <option value="145">145</option>
          <option value="146">146</option>
          <option value="147">147</option>
          <option value="148">148</option>
          <option value="149">149</option>
          <option value="150">150</option>
          <option value="151">151</option>
          <option value="152">152</option>
          <option value="153">153</option>
          <option value="154">154</option>
          <option value="155">155</option>
          <option value="156">156</option>
          <option value="157">157</option>
          <option value="158">158</option>
          <option value="159">159</option>
          <option value="160">160</option>
          <option value="161">161</option>
          <option value="162">162</option>
          <option value="163">163</option>
          <option value="164">164</option>
          <option value="165">165</option>
          <option value="166">166</option>
          <option value="167">167</option>
          <option value="168">168</option>
          <option value="169">169</option>
          <option value="170">170</option>
          <option value="171">171</option>
          <option value="172">172</option>
          <option value="173">173</option>
          <option value="174">174</option>
          <option value="175">175</option>
          <option value="176">176</option>
          <option value="177">177</option>
          <option value="178">178</option>
          <option value="179">179</option>
          <option value="180">180</option>
          <option value="181">181</option>
          <option value="182">182</option>
          <option value="183">183</option>
          <option value="184">184</option>
          <option value="185">185</option>
          <option value="186">186</option>
          <option value="187">187</option>
          <option value="188">188</option>
          <option value="189">189</option>
          <option value="190">190</option>
          <option value="191">191</option>
          <option value="192">192</option>
          <option value="193">193</option>
          <option value="194">194</option>
          <option value="195">195</option>
          <option value="196">196</option>
          <option value="197">197</option>
          <option value="198">198</option>
          <option value="199">199</option>
          <option value="200">200</option>
        </select>
      </div>
      <div class="form-group col-sm-6 col-md-6 col-lg-4">
        <label for="domain">Domain</label>
        <select id="domain" name="domain">
          <option value="rhnaps.io">rhnaps.io</option>
          <option value="redhatgov.io">redhatgov.io</option>
          <option value="az.redhatgov.io">az.redhatgov.io</option>
          <option value="redhat-fierce.io">redhat-fierce.io</option>
          <option value="fiercesw.network">fiercesw.network</option>
          <option value="rhtps.io">rhtps.io</option>
          <option value="openshiftworkshop.com">openshiftworkshop.com</option>
          <option value="redhatpsmwsa.com">redhatpsmwsa.com</option>
          <option value="open.redhat.com">open.redhat.com</option>
          <option value="opentlc.com">opentlc.com</option>
          <option value="aroapp.io">aroapp.io</option>
          <option value="danclark.io">danclark.io</option>
        </select>
      </div>
      <div class="form-group col-sm-6 col-md-6 col-lg-3">
        <label for="prefix">Workshop</label>
        <input id="prefix" name="prefix" type="text" size="16" class="form-control" placeholder="example" onkeyup="this.value = this.value.toLowerCase();this.value = this.value.replace(/[^-.a-zA-Z0-9]/g, '');"/>
      </div>
      <div class="form-group col-sm-6 col-md-6 col-lg-3">
        <button type="submit" class="btn btn-primary form-control" style="margin-bottom:1rem;">Enter</button>
        <button type="reset" class="btn btn-default form-control">Default</button>
      </div>
    </form>
  </div>
</div>

    </div>
    <div class="modal-footer">
      <h3></h3>
    </div>
  </div>

</div>

<script type="text/javascript" src="/node_modules/js-cookie/src/js.cookie.js"></script>
<script type="text/javascript">

  
  var Cookies2 = Cookies.noConflict();

  var cookiePathArr = cleanArray(window.location.pathname.split('/'));
  var cookiePath = '/' + cookiePathArr[0] + '/' + cookiePathArr[1] + '/';

  function cleanArray(actual) {
    var newArray = new Array();
    for (var i = 0; i < actual.length; i++) {
      if (actual[i]) {
        newArray.push(actual[i]);
      }
    }
    return newArray;
  }
  function replaceClassText() {
    jQuery("span.domain").html(Cookies2.get("domain"));
    jQuery("span.userid").html(Cookies2.get("userid"));
    jQuery("span.prefix").html(Cookies2.get("prefix"));
  }
  function pageLoadWorkshopFooterTest() {
    
    if (Cookies2.get("domain") === undefined) {
      resetWorkshopFooter();
    }
    else {
      replaceClassText();
      setWorkshopFooterInputValues()
    }
  }
  function setWorkshopFooterData() {
    
    Cookies2.set("domain", jQuery("select#domain").val(), { path: cookiePath, expires: 7 } );
    Cookies2.set("prefix", jQuery("input#prefix").val().replace(/[^-.a-zA-Z0-9]/g, ''), { path: cookiePath, expires: 7 } );
    Cookies2.set("userid", jQuery("select#userid").val(), { path: cookiePath, expires: 7 } );
    replaceClassText();
    modal.style.display = "none";
  }
  function setWorkshopFooterInputValues() {
    jQuery("select#domain").val(Cookies2.get("domain"));
    jQuery("input#prefix").val(Cookies2.get("prefix"));
    jQuery("select#userid").val(Cookies2.get("userid"));
  }
  function resetWorkshopFooter() {
    
    jQuery("select#domain, select#userid").prop("selectedIndex", 0);
    jQuery("input#prefix").val(jQuery("input#prefix").attr('placeholder'));
    
    Cookies2.set("domain", jQuery("select#domain option").first().val(), { path: cookiePath, expires: 7 } ); 
    Cookies2.set("userid", jQuery("select#userid option").first().val(), { path: cookiePath, expires: 7 } ); 
    Cookies2.set("prefix", jQuery("input#prefix").val(), { path: cookiePath, expires: 7 } );
    
    
    replaceClassText();
  }




  function updateFooter(e){
    fieldName = '';

    switch(e.id) {
      case 'userid':
        fieldName = 'User Id';
        break;
      case 'domain':
        fieldName = 'Domain';
        break;
      case 'prefix':
        fieldName = 'Workshop';
        break;
      default:
        fieldName = 'unknown';
    }
    setWorkshopFooterData();
    toastr["success"](fieldName + " set to " + e.value);
  }

  jQuery(document).ready(function() {
    pageLoadWorkshopFooterTest();


    
    var input = document.getElementById("prefix");

    
    input.addEventListener("keyup", function(event) {
      
      if (event.keyCode === 13) {
        
        event.preventDefault();
        
        
        updateFooter(input);
      }
    });


    jQuery("form#footerForm").submit(function() {
      setWorkshopFooterData();
      return false; 
    });

    jQuery("form#footerForm").bind("reset", function() {
      resetWorkshopFooter();
      return true;
    });

    return false;
  });

</script>

<hr>
<h3>Workshop Details</h3>
    <table>
      <tr>
        <td class="text-right"><b>Domain</b></td>
        <td><span class="domain"></span></td>
        <td rowspan="3">
          <img src="/images/Logo-Red_Hat-C-Standard-RGB-small.png" alt="Red Hat Logo" />
        </td>
      </tr>
      <tr>
        <td class="text-right"><b>Workshop</b></td>
        <td><span class="prefix"></span></td>
      </tr>
      <tr>
        <td class="text-right"><b>Student ID</b></td>
        <td><span class="userid"></span></td>
      </tr>
    </table>
<button id="myBtn">Configure Workshop</button>
<hr>

<script>

var modal = document.getElementById("myModal");


var btn = document.getElementById("myBtn");


var span = document.getElementsByClassName("close")[0];


btn.onclick = function() {
  modal.style.display = "block";
}


span.onclick = function() {
  modal.style.display = "none";
}


window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}
</script>

</p>
</div>
</div>
</div>


    








<nav>
  <ul class="pager">
    
    
    <li class="previous">
      <a href="/workshops/security_containers/exercise1.8/">&larr; Previous: Exercise 1.8 - SELinux</a>
    </li>
    
    
    
    
    <li class="next">
      <a href="/workshops/security_containers/wrapup/">Next: Wrap Up &rarr;</a>
    </li>
    
    
  </ul>
</nav>

    <p class="text-center">
      
      <a href="/workshops/security_containers">Return to Workshop</a>
    </p>
  </div>
</div>

    <div id="page-footer" class="container">
      <p class="text-center">
        Copyright &copy; 2024 Red Hat, Inc.
      </p>
    </div>
    <script type="text/javascript">
      if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
          _satellite.pageBottom();
      }
    </script>
  </body>
</html>
